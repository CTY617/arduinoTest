const int buttonPin = 4;
const int redPin = 5;
const int greenPin = 7;
const int bluePin = 6;

unsigned long lastChange = 0;
const unsigned long interval = 1000; // 每秒切換
int state = 0; // 0=green, 1=yellow, 2=red

void setup() {
  pinMode(buttonPin, INPUT_PULLUP); // 按鈕接地，按下為 LOW
  pinMode(redPin, OUTPUT);
  pinMode(greenPin, OUTPUT);
  pinMode(bluePin, OUTPUT);

  // 初始顯示
  setColorByState(state);
}

void loop() {
  bool pressed = digitalRead(buttonPin) == LOW;

  if (pressed) {
    // 按住時全部熄滅（共陽極：HIGH 為關）
    allOff();
    // 不改變 lastChange 或 state，放開後繼續上次順序
    return;
  }

  // 若未按下，按時序每秒切換
  unsigned long now = millis();
  if (now - lastChange >= interval) {
    lastChange = now;
    state = (state + 1) % 3;
    setColorByState(state);
  }

  // 小睡一下以減少 CPU 使用（非必要）
  delay(10);
}

void setColorByState(int s) {
  switch (s) {
    case 0: // 綠
      digitalWrite(redPin, HIGH);
      digitalWrite(greenPin, LOW);
      digitalWrite(bluePin, HIGH);
      break;
    case 1: // 黃 = 紅 + 綠
      digitalWrite(redPin, LOW);
      digitalWrite(greenPin, LOW);
      digitalWrite(bluePin, HIGH);
      break;
    case 2: // 紅
      digitalWrite(redPin, LOW);
      digitalWrite(greenPin, HIGH);
      digitalWrite(bluePin, HIGH);
      break;
  }
}

void allOff() {
  digitalWrite(redPin, HIGH);
  digitalWrite(greenPin, HIGH);
  digitalWrite(bluePin, HIGH);
    }
}
